"use strict";(self.webpackChunkkuzu_docs=self.webpackChunkkuzu_docs||[]).push([[9020],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var c=n.createContext({}),l=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,o=e.originalType,c=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),p=l(a),d=s,h=p["".concat(c,".").concat(d)]||p[d]||m[d]||o;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=a.length,i=new Array(o);i[0]=d;var r={};for(var c in t)hasOwnProperty.call(t,c)&&(r[c]=t[c]);r.originalType=e,r[p]="string"==typeof e?e:s,i[1]=r;for(var l=2;l<o;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},8644:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>c,metadata:()=>u,toc:()=>m});var n=a(7462),s=(a(7294),a(3905)),o=a(4505),i=a(7858),r=a(6375);const c={slug:"iamgraphviz",authors:[{name:"Chris Norman",title:"Common Fate",url:"https://www.linkedin.com/in/chrnorm/?originalSubdomain=uk",image_url:"https://www.commonfate.io/_next/image?url=%2Fheadshots%2Fchris.jpg&w=3840&q=75"},"chang"],tags:["use-case"]},l="IAMGraphViz: Visualizing AWS IAM Permissions with K\xf9zu",u={permalink:"/docusaurus/blog/iamgraphviz",source:"@site/blog/2023-07-19-iamgraphviz/index.md",title:"IAMGraphViz: Visualizing AWS IAM Permissions with K\xf9zu",description:"IAMGraphViz Overview",date:"2023-07-19T00:00:00.000Z",formattedDate:"July 19, 2023",tags:[{label:"use-case",permalink:"/docusaurus/blog/tags/use-case"}],readingTime:6.03,hasTruncateMarker:!0,authors:[{name:"Chris Norman",title:"Common Fate",url:"https://www.linkedin.com/in/chrnorm/?originalSubdomain=uk",image_url:"https://www.commonfate.io/_next/image?url=%2Fheadshots%2Fchris.jpg&w=3840&q=75",imageURL:"https://www.commonfate.io/_next/image?url=%2Fheadshots%2Fchris.jpg&w=3840&q=75"},{name:"Chang Liu",url:"https://www.linkedin.com/in/mewim/",imageURL:"https://kuzudb.com/img/blog/chang.gif",key:"chang"}],frontMatter:{slug:"iamgraphviz",authors:[{name:"Chris Norman",title:"Common Fate",url:"https://www.linkedin.com/in/chrnorm/?originalSubdomain=uk",image_url:"https://www.commonfate.io/_next/image?url=%2Fheadshots%2Fchris.jpg&w=3840&q=75",imageURL:"https://www.commonfate.io/_next/image?url=%2Fheadshots%2Fchris.jpg&w=3840&q=75"},"chang"],tags:["use-case"]},prevItem:{title:"K\xf9zu 0.0.7 Release",permalink:"/docusaurus/blog/kuzu-0.0.7-release"},nextItem:{title:"K\xf9zu 0.0.6 Release",permalink:"/docusaurus/blog/kuzu-0.0.6-release"}},p={authorsImageUrls:[void 0,void 0]},m=[{value:"IAMGraphViz Overview",id:"iamgraphviz-overview",level:2},{value:"Quick AWS IAM Overview",id:"quick-aws-iam-overview",level:2},{value:"Example Visualizations",id:"example-visualizations",level:2},{value:"Data Generation",id:"data-generation",level:3},{value:"Visualization 1: Draw all users with direct or indirect <code>ReadOnlyAccess</code> access to an account",id:"visualization-1-draw-all-users-with-direct-or-indirect-readonlyaccess-access-to-an-account",level:3},{value:"Visualization 2: Draw all accounts a user has <code>AdministratorAccess</code> to",id:"visualization-2-draw-all-accounts-a-user-has-administratoraccess-to",level:3},{value:"Closing Words",id:"closing-words",level:2}],d={toc:m},h="wrapper";function g(e){let{components:t,...a}=e;return(0,s.kt)(h,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"iamgraphviz-overview"},"IAMGraphViz Overview"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://www.commonfate.io/"},"Common Fate"),"  is a framework for managing complex cloud permissions. They provide tools to simplify access at scale to AWS, Azure, and Google Cloud accounts. You can learn about what you can do with Common Fate on ",(0,s.kt)("a",{parentName:"p",href:"https://www.commonfate.io/"},"their website"),". Here, we will talk about a recent proof of concept graph visualization tool called IAMGraphViz that ",(0,s.kt)("a",{parentName:"p",href:"https://www.linkedin.com/in/mewim/"},"Chang Liu")," (who is coauthoring this post) and I developed using K\xf9zu! IAMGraphViz is intended for infrastructure engineers to dig deep into the permission assignments in AWS IAM Identity Center using graph visualization. Using IAMGraphViz, one can easily visualize who has what type of access to different accounts on AWS as well as how they have access to these accounts. This is all done by analyzing the paths from users to accounts in a graph visualization, where the nodes and edges model users, accounts, groups, group memberships, permission sets and other entities in the AWS IAM Identity Center system."),(0,s.kt)("p",null,"The IAMGraphViz project is designed and implemented as a web application using a graph DBMS (GDBMS) to store and retrieve data. Before landing on K\xf9zu, we surveyed using several other GDBMSs, such as Neo4j, but they were all harder to use. Neo4j, for example, requires hosting a separate database. We then discovered K\xf9zu, which only required a ",(0,s.kt)("inlineCode",{parentName:"p"},"pip install")," and import statement and we could simply embed it into our application. In this project our datasets could fit entirely onto a single compute node,and so K\xf9zu was far simpler for us to work with than alternatives. K\xf9zu is also far cheaper and more serverless-friendly than running a separate database."),(0,s.kt)("p",null,"This post follows the ",(0,s.kt)("a",{parentName:"p",href:"https://colab.research.google.com/drive/1fotlNnOj1FGad6skBG7MRrHVdHd3jIl6"},"Colab")," that Chang Liu created after we discussed this use case together."),(0,s.kt)("p",null,"So let's get to it!"),(0,s.kt)("h2",{id:"quick-aws-iam-overview"},"Quick AWS IAM Overview"),(0,s.kt)("p",null,"We will use the data model shown in the figure below that faithfully (but partially) models the\ncore concepts of AWS IAM permission management. Let's first review these concepts, all\nof which will be modeled as nodes in K\xf9zu, as a background.\nWe will provide as simple definitions as we can to keep the post short and provide links\nto necessary AWS IAM documentation: "),(0,s.kt)("div",{class:"img-center"},(0,s.kt)("img",{src:o.Z,width:"600"})),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html"},"User"))," represents a\nuser, e.g., an actual human user, who can get access to AWS accounts (and through accounts to AWS resources).")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html"},"Group"))," is a collection of IAM users and lets you specify permissions for multiple users at a time (e.g., you could have a user group called Admins with typical administrator permissions).\nTo follow the APIs we use, instead of linking Users to Groups through a direct edge, we will do this (a bit redundantly) through a GroupMembership node.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/organizations/latest/userguide/orgs_getting-started_concepts.html#account"},"Account")),": An AWS account is the basic container for your AWS resources, such as s3 buckets,\nAmazon Relational Database Service (Amazon RDS) databases, or Amazon Elastic Compute Cloud instances.\nUsing multiple AWS accounts is a common practice for many reasons, e.g., providing a natural billing boundary for costs or isolating resources for security. Common Fate customers have hundreds of\naccounts, which is not an extreme.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html"},"IAM Policy")),", and ",(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#aws-managed-policies"},"ManagedPolicy")),": An IAM policy contains permissions for using some AWS resources. An AWS managed policy is a policy with a unique Amazon Resource Name (ARN), e.g., ",(0,s.kt)("inlineCode",{parentName:"p"},"arn:aws:iam::aws:policy/IAMReadOnlyAccess"),", that is administered by AWS. Managed policies are common policies used by many enterprises. Managed policies are simpler to use than writing your custom policies.\nFor simplicity, we will only model AWS managed policies in this post.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://docs.aws.amazon.com/singlesignon/latest/userguide/permissionsetsconcept.html"},"PermissionSet"))," is a set of policies that can be attached to users or groups (through AccountAssignments which we explain momentarily). For example, you can create a Database Admin permission set that includes policies for administering Amazon RDS, DynamoDB, and Aurora services, and use that single permission set to grant access to a list of target AWS accounts. Similar to GroupMembership nodes, to follow the APIs we use, instead of linking ManagedPolicy nodes to PermissionSet nodes through a direct edge, we will link them through a ManagedPolicyAttachment node.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},(0,s.kt)("strong",{parentName:"p"},(0,s.kt)("a",{parentName:"strong",href:"https://aws.amazon.com/about-aws/whats-new/2020/09/aws-single-sign-on-adds-account-assignment-apis-and-aws-cloudformation-support-to-automate-multi-account-access-management/"},"Account Assignment")),": We will connect user and/or groups to AWS accounts with a specific permission set through an ",(0,s.kt)("inlineCode",{parentName:"p"},"AccountAssignment")," node (see the schema above). "))),(0,s.kt)("h2",{id:"example-visualizations"},"Example Visualizations"),(0,s.kt)("h3",{id:"data-generation"},"Data Generation"),(0,s.kt)("p",null,"In the attached ",(0,s.kt)("a",{parentName:"p",href:"https://colab.research.google.com/drive/1fotlNnOj1FGad6skBG7MRrHVdHd3jIl6"},"Colab notebook"),', we first generate some test data\ncontaining Users, Groups, ManagedPolicies, PermissionSets etc. For simplicity, we assume that there are three fixed groups: "Admins", "Developers", and "Auditors" and three ManagedPolicies: "AdministratorAccess", "PowerUserAccess", and "ReadOnlyAccess". Users, Accounts,\nAccountAssignments, and PermissionSets are randomly generated and we randomly link different nodes to\nother nodes according to our schema.'),(0,s.kt)("h3",{id:"visualization-1-draw-all-users-with-direct-or-indirect-readonlyaccess-access-to-an-account"},"Visualization 1: Draw all users with direct or indirect ",(0,s.kt)("inlineCode",{parentName:"h3"},"ReadOnlyAccess")," access to an account"),(0,s.kt)("p",null,"In our first query, we are given a particular account we would like to investigate and find\nall users who have ",(0,s.kt)("inlineCode",{parentName:"p"},"ReadOnlyAccess")," to the resources of this account. Let's assume\nthe account's name is \"account-db2071\"."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-cypher"},'MATCH (u:User)<-[l*1..3]-(aa:AccountAssignment)-[l5]-(a:Account),\n(aa:AccountAssignment)-[aaps]->(ps:PermissionSet)<-[psmpa]-(mpa:ManagedPolicyAttachment)-[mpap]->(p:ManagedPolicy)\nWHERE p.id = "arn:aws:iam::aws:policy/ReadOnlyAccess" AND a.sid = "account-db2071"\nRETURN *;\n')),(0,s.kt)("p",null,"In the actual IAMGraphViz implementation, we template this query with two parameters, one for the\naccount ID, and one for the managed policy, which users pick interactively by selecting from\na dropdown menu.\nNote also that the ",(0,s.kt)("inlineCode",{parentName:"p"},"[:*1..3]")," binding is a variable-length path because we want to find\nboth the direct connections from a ",(0,s.kt)("inlineCode",{parentName:"p"},"User")," to an ",(0,s.kt)("inlineCode",{parentName:"p"},"AccountAssignment")," (that is further connected to\n",(0,s.kt)("inlineCode",{parentName:"p"},"ManagedPolicy"),") as well as\nindirect connections through a ",(0,s.kt)("inlineCode",{parentName:"p"},"Group")," node. The visualization we generate is shown below:"),(0,s.kt)("div",{class:"img-center"},(0,s.kt)("img",{src:i.Z})),(0,s.kt)("p",null,"Note the presence of both directly and indirectly connected users to the account.\nThe visualization in both the actual implementation and the ",(0,s.kt)("a",{parentName:"p",href:"https://colab.research.google.com/drive/1fotlNnOj1FGad6skBG7MRrHVdHd3jIl6"},"Colab notebook")," is generated simply\nby converting the results of the query into the node and link objects of the graph visualization library,\ne.g., pyvis in the case of the Colab notebook."),(0,s.kt)("h3",{id:"visualization-2-draw-all-accounts-a-user-has-administratoraccess-to"},"Visualization 2: Draw all accounts a user has ",(0,s.kt)("inlineCode",{parentName:"h3"},"AdministratorAccess")," to"),(0,s.kt)("p",null,"In our second query, we are given a particular user we would like to investigate and find all accounts that the user has ",(0,s.kt)("inlineCode",{parentName:"p"},"AdministratorAccess")," to. Let's assume the user's name is \"Steven Rose\". "),(0,s.kt)("p",null,"To retrive the accounts, we define a Cypher query very similar to the previous one. The only difference is that, instead of using the account as query predicate, we now use the user. The query is as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-cypher"},'MATCH (u:User)<-[l*1..3]-(aa:AccountAssignment)-[l5]-(a:Account),\n(aa:AccountAssignment)-[aaps]->(ps:PermissionSet)<-[psmpa]-(mpa:ManagedPolicyAttachment)-[mpap]->(p:ManagedPolicy)\nWHERE p.id = "arn:aws:iam::aws:policy/AdministratorAccess" AND u.name = "Steven Rose"\nRETURN *;\n')),(0,s.kt)("p",null,"The visualization we generate is shown below:"),(0,s.kt)("div",{class:"img-center"},(0,s.kt)("img",{src:r.Z})),(0,s.kt)("h2",{id:"closing-words"},"Closing Words"),(0,s.kt)("p",null,"Many other graph visualizations can be helpful for infrastructure engineers to analyze the\nIAM network of an enterprise. For example, to find inconsistent privileges given to users,\nwe might want to ",(0,s.kt)("em",{parentName:"p"},"find and plot multiple paths from a user to an account with different privileges"),".\nOr we might want to extend our model with more fine grained resources that are connected to accounts\nand analyze paths from users to these resources (see the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/nccgroup/PMapper"},"PMapper")," project that models the IAM data in a more detailed way). The key takeaway is this: graph visualizations can be very powerful to analyze cloud permission data and embedding K\xf9zu into your applications\nto develop tools like IAMGraphViz is extremely easy and fun \ud83e\udd73\ud83d\ude4c\ud83d\udcaa!"))}g.isMDXComponent=!0},6375:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/adminviz-81efff2ce0d12c4a702fc8628963f727.png"},7858:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/readonlyviz-01a07dc37ec55c977e7a98acb5396133.png"},4505:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/schema-a1a8655501405ee6c34e17165daac04b.png"}}]);