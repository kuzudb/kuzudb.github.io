<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">K√πzu 0.0.3 Release | K√πzu</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://kuzudb.com/docusaurus/blog/kuzu-0.0.3-release"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="og:locale" content="en_US"><meta data-rh="true" name="og:type" content="article"><meta data-rh="true" name="og:site_name" content="K√πzu"><meta data-rh="true" name="og:image" content="https://kuzudb.com/img/logo-u-with-orange-tick.jpg"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="twitter:site" content="@kuzudb"><meta data-rh="true" name="twitter:creator" content="@kuzudb"><meta data-rh="true" name="twitter:image" content="https://kuzudb.com/img/logo-u-with-orange-tick.jpg"><meta data-rh="true" property="og:title" content="K√πzu 0.0.3 Release | K√πzu"><meta data-rh="true" name="description" content="We are happy to release K√πzu 0.0.3 today. This release comes with the following new main features and improvements:"><meta data-rh="true" property="og:description" content="We are happy to release K√πzu 0.0.3 today. This release comes with the following new main features and improvements:"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-04-06T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kuzudb/"><meta data-rh="true" property="article:tag" content="release"><link data-rh="true" rel="icon" href="/docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kuzudb.com/docusaurus/blog/kuzu-0.0.3-release"><link data-rh="true" rel="alternate" href="https://kuzudb.com/docusaurus/blog/kuzu-0.0.3-release" hreflang="en"><link data-rh="true" rel="alternate" href="https://kuzudb.com/docusaurus/blog/kuzu-0.0.3-release" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://XV0PE3XW33-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/docusaurus/blog/rss.xml" title="K√πzu RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/docusaurus/blog/atom.xml" title="K√πzu Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="K√πzu" href="/docusaurus/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer"><link rel="stylesheet" href="/docusaurus/assets/css/styles.a72d597a.css">
<link rel="preload" href="/docusaurus/assets/js/runtime~main.67b2cda9.js" as="script">
<link rel="preload" href="/docusaurus/assets/js/main.2d80c558.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://kuzudb.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/docusaurus/img/kuzu-logo.png" alt="K√πzu" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docusaurus/img/kuzu-logo-inverse.png" alt="K√πzu" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/docusaurus/installation">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docusaurus/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item">
            <a href="https://github.com/kuzudb/kuzu" class="navbar__link navbar__link--social">
              <i class="fa-brands fa-github fa-xl"></i>
            </a>
            </div><div class="navbar__item">
            <a href="https://join.slack.com/t/kuzudb/shared_invite/zt-1w0thj6s7-0bLaU8Sb~4fDMKJ~oejG_g" class="navbar__link navbar__link--social">
              <i class="fa-brands fa-slack fa-xl"></i>
            </a>
            </div><div class="navbar__item">
            <a href="https://twitter.com/kuzudb" class="navbar__link navbar__link--social">
              <i class="fa-brands fa-twitter fa-xl"></i>
            </a>
            </div><div class="navbar__item">
            <a href="https://www.youtube.com/@KuzuDB" class="navbar__link navbar__link--social">
              <i class="fa-brands fa-youtube fa-xl"></i>
            </a>
            </div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-0.0.7-release">K√πzu 0.0.7 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/iamgraphviz">IAMGraphViz: Visualizing AWS IAM Permissions with K√πzu</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-0.0.6-release">K√πzu 0.0.6 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-0.0.5-release">K√πzu 0.0.5 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-0.0.4-release">K√πzu 0.0.4 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-pyg-remote-backend">Scaling Pytorch Geometric GNNs With K√πzu</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/docusaurus/blog/kuzu-0.0.3-release">K√πzu 0.0.3 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/wcoj">Why (Graph) DBMSs Need New Join Algorithms: The Story of Worst-case Optimal Join Algorithms</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/kuzu-0.0.2-release">K√πzu 0.0.2 Release</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/factorization">Factorization &amp; Great Ideas from Database Theory</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/what-every-gdbms-should-do-and-vision">What Every Competent GDBMS Should Do (aka The Goals &amp; Vision of K√πzu</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/docusaurus/blog/meet-kuzu">Meet K√πzu ü§ó</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">K√πzu 0.0.3 Release</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-04-06T00:00:00.000Z" itemprop="datePublished">April 6, 2023</time> ¬∑ <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kuzudb/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://kuzudb.com/img/blog/team.jpg" alt="K√πzu Team"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/kuzudb/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">K√πzu Team</span></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>We are happy to release K√πzu 0.0.3 today. This release comes with the following new main features and improvements:</p><ul><li><a href="/docusaurus/blog/kuzu-0.0.3-release#k%C3%B9zu-as-a-pyg-remote-backend">K√πzu as a Pytorch Geometric (PyG) Remote Backend</a>: You can now train PyG GNNs and other models directly using graphs (and node features) stored on K√πzu.  See this <a href="https://colab.research.google.com/drive/12fOSqPm1HQTz_m9caRW7E_92vaeD9xq6" target="_blank" rel="noopener noreferrer">Colab notebook</a>
for a demonstrative example. </li><li><a href="/docusaurus/blog/kuzu-0.0.3-release#data-ingestion-improvements">Data ingestion from multiple files and numpy files</a>: See below for details</li><li><a href="/docusaurus/blog/kuzu-0.0.3-release#query-optimizer-improvements">Query optimizer improvements</a>: See below for details</li><li><a href="/docusaurus/blog/kuzu-0.0.3-release#new-buffer-manager">New buffer manager</a>: A new state-of-art buffer manager based on <a href="https://www.cs.cit.tum.de/fileadmin/w00cfj/dis/_my_direct_uploads/vmcache.pdf" target="_blank" rel="noopener noreferrer">VMCache</a>.</li><li><a href="/docusaurus/blog/kuzu-0.0.3-release#new-data-types">INT32, INT16, FLOAT, and FIXED LIST data types</a> (the latter is particularly suitable to store node features in graph ML applications)</li><li><a href="/docusaurus/blog/kuzu-0.0.3-release#other-system-functionalities">Query timeout mechanism and interrupting queries from CLI</a>.</li></ul><p>For installing the new version,
please visit the <a href="https://kuzudb.com/#download" target="_blank" rel="noopener noreferrer">download section of our website</a>
and <a href="https://kuzudb.com/docs/getting-started.html" target="_blank" rel="noopener noreferrer">getting started guide</a> and the full
<a href="https://github.com/kuzudb/kuzu/releases" target="_blank" rel="noopener noreferrer">release notes are here</a>. Please visit
the <a href="https://kuzudb.com/docs/getting-started/colab-notebooks" target="_blank" rel="noopener noreferrer">Colab Notebooks</a> section of our
documentation website to play with our <a href="https://kuzudb.com/docs/getting-started/colab-notebooks" target="_blank" rel="noopener noreferrer">Colab notebooks</a>.</p><p>Enjoy! Please give us a try, <a href="https://github.com/kuzudb/kuzu" target="_blank" rel="noopener noreferrer">a Github ‚≠ê</a> and your feedback and feature requests! Also follow
us on <a href="https://twitter.com/kuzudb" target="_blank" rel="noopener noreferrer">Twitter</a>!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="k√πzu-as-a-pyg-remote-backend">K√πzu as a PyG Remote Backend<a href="#k√πzu-as-a-pyg-remote-backend" class="hash-link" aria-label="Direct link to K√πzu as a PyG Remote Backend" title="Direct link to K√πzu as a PyG Remote Backend">‚Äã</a></h2><p>K√πzu now implements PyG&#x27;s Remote Backend interface. So you can directly
train GNNs using K√πzu as your backend storage. Quoting <a href="https://pytorch-geometric.readthedocs.io/en/latest/advanced/remote.html" target="_blank" rel="noopener noreferrer">PyG documentation&#x27;s</a> description
of the Remote Backend feature:</p><blockquote><p>...<!-- -->[this feature enables]<!-- --> users to train GNNs on graphs far larger than the size of their
machine‚Äôs available memory. It does so by introducing simple, easy-to-use, and extensible abstractions of a <code>torch_geometric.data.FeatureStore</code> and a   <code>torch_geometric.data.GraphStore</code> that plug directly into existing familiar PyG interfaces.</p></blockquote><p>With our current release, once you store your graph and features in K√πzu,
PyG&#x27;s samplers work seamlessly using K√πzu&#x27;s implementation of <code>FeatureStore</code> and <code>GraphStore</code> interfaces. For example,
this enables your existing GNN models to work seamlessly by fetching both subgraph samples and node features
from K√πzu instead of PyG&#x27;s in-memory storage.
Therefore you can train graphs that do not
fit into your memory since K√πzu, as a DBMS, stores its data on disk. Try this demonstrative <a href="https://colab.research.google.com/drive/12fOSqPm1HQTz_m9caRW7E_92vaeD9xq6" target="_blank" rel="noopener noreferrer">Colab notebook</a> to
see an example of how to do this. The current release comes with a limitation that we only truly implement the <code>FeatureStore</code> interface.
Inside <code>GraphStore</code> we still store the graph topology in memory.
So in reality only the features are stored and scanned from disk. We plan to address this limitation later on.</p><p>Here is also a demonstrative experiment (but certainly not comprehensive study) for the type of training performance
vs memory usage tradeoff you can expect.
We trained a simple 3-layers Graph Convolutional Network (GCN) model on <a href="https://ogb.stanford.edu/docs/nodeprop/#ogbn-papers100M" target="_blank" rel="noopener noreferrer">ogbn-papers100M</a> dataset, which contains about 111 million nodes
with 128 dimensional node features and about 1.6 billion edges.
Storing the graph topology takes around 48GB<sup id="fnref-1-3b764c"><a href="#fn-1-3b764c" class="footnote-ref">1</a></sup> and the features takes 53 GBs. Given our current limitation,
we can reduce 53 GB to something much smaller (we will limit it to as low as 10GB).
We used a machine with one RTX 4090 GPU with 24 GB of memory, two Xeon Platinum 8175M CPUs, and 384 GB RAM, which
is enough for PyG&#x27;s in-memory store to store the entire graph and all features in memory.</p><p>During training, we use the <code>NeighborLoader</code> of PyG with batch size of 48000 and sets the <code>num_neighbors</code> to <code>[30] * 2</code>, which means at each batch roughly 60 neighbor nodes of 48000 nodes will be sampled from the <code>GraphStore</code> and the features of those nodes will be scanned
from K√πzu&#x27;s storage. We picked this sample size because this gives us a peak GPU memory usage of approximately 22 GB, i.e.,
we can saturate the GPU memory. We used 16 cores<sup id="fnref-2-3b764c"><a href="#fn-2-3b764c" class="footnote-ref">2</a></sup> during the sampling process. We run each experiment in a Docker instance
and limit the memory systematically from 110GB, which is enough for PyG to run completely in memory, down to 90, 70, and 60GB.
At each memory level we run the same experiment by using K√πzu as a Remote Backend, where we
have to use about 48GB to store the topology and give the remaining memory to K√πzu&#x27;s buffer manager.
For example when the memory is 60GB, we can only give ~10GB to K√πzu.</p><table><thead><tr><th>Configuration</th><th>End to End Time (s)</th><th>Per Batch Time (s)</th><th>Time Spent on Training (s)</th><th>Time Spent on Copying to GPU (s)</th><th>Docker Memory</th></tr></thead><tbody><tr><td>PyG In-memory</td><td>140.17</td><td>1.4</td><td>6.62</td><td>31.25</td><td>110 GB</td></tr><tr><td>K√πzu Remote Backend (bm=60GB)</td><td>392.6</td><td>3.93</td><td>6.29</td><td>34.18</td><td>110 GB</td></tr><tr><td>K√πzu Remote Backend (bm=40GB)</td><td>589.0</td><td>5.89</td><td>6.8</td><td>32.6</td><td>90 GB</td></tr><tr><td>K√πzu Remote Backend (bm=20GB)</td><td>1156.1</td><td>11.5</td><td>6.0</td><td>36</td><td>70 GB</td></tr><tr><td>K√πzu Remote Backend (bm=10GB)</td><td>1121.92</td><td>11.21</td><td>6.88</td><td>35.03</td><td>60 GB</td></tr></tbody></table><p>So, when have enough memory, there is about 2.8x slow down (from 1.4s to 3.93s per batch). This
is the case when K√πzu has enough buffer memory (60GB) to store the 53GB of features but we still incur the cost of
scanning them through K√πzu&#x27;s buffer manager. So no or very little disk I/O happens (except the first time
the features are scanned to the buffer manager). Then as we lower the memory, K√πzu can hold only part
of the of node features in its buffer manager, so
we force K√πzu to do more and more I/O. The per batch time increase to 5.89s at 40GB of buffer manager size,
then seems to stabilize around 11s (so around 8.2x slowdown). </p><p>The slow down is better if you use smaller batch sizes but for the end to end training time, you
should probably still prefer to use larger batch sizes. This is a place where we would need to
do more research to see how much performance is on the table with further optimizations.</p><p>But in summary, if you have
large datasets that don&#x27;t fit on your current systems&#x27; memories and would like to easily train your PyG models
off of disk (plus get all the usability features of a GDBMS as you prepare your datasets for training),
this feature can be very useful for you!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-ingestion-improvements">Data Ingestion Improvements<a href="#data-ingestion-improvements" class="hash-link" aria-label="Direct link to Data Ingestion Improvements" title="Direct link to Data Ingestion Improvements">‚Äã</a></h2><p><strong>Ingest from multiple files</strong>: You can now load data from multiple files of the same type into a node/rel table in two ways:</p><ul><li><strong>file list</strong>: <code>[&quot;vPerson0.csv&quot;, &quot;vPerson1.csv&quot;, &quot;vPerson2.csv&quot;]</code></li><li><strong>glob pattern matching</strong>: Similar to Linux <a href="https://man7.org/linux/man-pages/man7/glob.7.html" target="_blank" rel="noopener noreferrer">Glob</a>, this will load files that matches the glob pattern.</li></ul><p><strong>Ingest from npy files</strong>: We start exploring how to enable data ingesting in column by column fashion. Consider a <code>Paper</code> table defined in the following DDL.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE NODE TABLE Paper(id INT64, feat FLOAT[768], year INT64, label DOUBLE, PRIMARY KEY(id));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Suppose your raw data is stored in npy formats where each column is represented as a numpy array on disk:
&quot;node_id.npy&quot;, &quot;node_feat_f32.npy&quot;, &quot;node_year.npy&quot;, &quot;node_label.npy&quot;.
You can now directly copy from npy files where each file is loaded to a column in <code>Paper</code> table as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COPY Paper FROM (&quot;node_id.npy&quot;, &quot;node_feat_f32.npy&quot;, &quot;node_year.npy&quot;, &quot;node_label.npy&quot;) BY COLUMN;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Reduce memory consumption when ingesting data into node tables:</strong>
This release further optimizes the memory consumption during data ingestion of node tables.
We no longer keep the whole node table in memory before flushing it to disk as a whole. Instead, we process a chunk of a file
and flush its corresponding pages, so incur only the memory cost of ingesting a chunk (or as many chunks as there are threads running).
This greatly reduces memory usage when the node table is very large.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-optimizer-improvements">Query Optimizer Improvements<a href="#query-optimizer-improvements" class="hash-link" aria-label="Direct link to Query Optimizer Improvements" title="Direct link to Query Optimizer Improvements">‚Äã</a></h2><p><strong>Projection push down for sink operator</strong>:
We now push down projections down to the first sink operator
above the last point in a query plan they are needed.
Consider the following query</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MATCH (a:person) WHERE a.age &gt; 35 RETURN a.salary AS s ORDER BY s;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This query&#x27;s (simplified) plan is:  <code>Scan-&gt;Filter-&gt;OrderBY-&gt;ResultCollector</code>, where both
<code>ORDER BY</code> and the final <code>ResultCollector</code> are sink operators.
<code>ResultCollector</code> is where we accumulate the expressions in the <code>RETURN</code> clause.
This is simplified because <code>ORDER BY</code> actually consists of several physical operators.
Both column <code>age</code> and <code>salary</code> are scanned initially but only <code>salary</code> is needed in <code>ResultCollector</code>.
<code>age</code>, which is needed by <code>Filter</code> is projected out in the <code>ResultCollector</code>. We now push the projection of <code>age</code>
to <code>ORDER BY</code>, so <code>ORDER BY</code> does not have to materialize it.</p><p><strong>Other optimizations:</strong> We implemented several other optimizations, such as we reorder the filter expressions so equality conditions
are evaluated first, several improvements to cardinality estimator, and improved sideway information passing for joins. For the latter,
in our core join operator, which we called  ASP-Joins in our <a href="https://www.cidrdb.org/cidr2023/papers/p48-jin.pdf" target="_blank" rel="noopener noreferrer">CIDR paper</a>, we would blindly
perform sideways information passing (sip) from build to probe (or vice versa;
see <a href="https://www.cidrdb.org/cidr2023/papers/p48-jin.pdf" target="_blank" rel="noopener noreferrer">our paper</a> for details). Sometimes if there is no
filters on the probe and build sides, this is just an overhead as it won&#x27;t decrease the amount of scans on either side.
In cases where we think sip won&#x27;t help reduce scans, we do vanilla Hash Joins now.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-buffer-manager">New Buffer Manager<a href="#new-buffer-manager" class="hash-link" aria-label="Direct link to New Buffer Manager" title="Direct link to New Buffer Manager">‚Äã</a></h2><p>Before this release, we had two internal buffer pools with 2 different frame sizes of 4KB and 256KB,
so operators could only grab buffers of these two sizes. Plus when you loaded your DB and wanted to allocate
say 10GB buffer pool, we manually gave a fixed percentage to 4KB pool and the rest to 256KB pool.
This didn&#x27;t give any flexibility for storing large objects and complicated code to manage
buffers when operators needed them.  Terrible design;
just don&#x27;t do this!</p><p>We bit the bullet and decided to read the literature and pick a state-of-art buffer manager design that is
also practical. We switched to the mmap-based approach described in VMCache design from <a href="https://www.cs.cit.tum.de/fileadmin/w00cfj/dis/_my_direct_uploads/vmcache.pdf" target="_blank" rel="noopener noreferrer">this recent paper</a> by Leis et al..
This is a very nice design
and makes it very easy to support multiple buffer sizes very easily and only uses hardware locks (we used
software locks in our previous buffer manager). It also supports using optimistic reading,
which we verified improves our query performance a lot.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-data-types">New Data Types<a href="#new-data-types" class="hash-link" aria-label="Direct link to New Data Types" title="Direct link to New Data Types">‚Äã</a></h2><p>We now support several additional data types that were missing.</p><p><strong><a href="https://kuzudb.com/docs/cypher/data-types/list.html" target="_blank" rel="noopener noreferrer">FIXED-LIST</a> data type:</strong> This is important if you&#x27;re doing graph ML and storing node features
in K√πzu. It is the efficient way to store fixed-length vectors. Here&#x27;s the summary of how
to declare a node or rel property in your schemas to use the fixed-list data type.</p><table><thead><tr><th>Data Type</th><th>Description</th><th>DDL definition</th></tr></thead><tbody><tr><td>FIXED-LIST</td><td>a list of fixed number of values of the same numerical type</td><td>INT64<!-- -->[8]</td></tr></tbody></table><p>When possible use FIXED LIST instead of regular <a href="https://kuzudb.com/docs/cypher/data-types/list.html" target="_blank" rel="noopener noreferrer">VAR-LIST</a> data type
for cases when you know the size of your lists/vectors. It&#x27;s much more efficient.</p><p>Note that FIXED-LIST is an experimental feature. Currently only bulk loading (e.g. <code>COPY</code> statement) and reading is supported.</p><p><strong>INT32, INT16, FLOAT data types:</strong> The release also comes with support for the following data types:</p><table><thead><tr><th>Data Type</th><th>Size</th><th>Description</th></tr></thead><tbody><tr><td>INT32</td><td>4 bytes</td><td>signed four-byte integer</td></tr><tr><td>INT16</td><td>2 bytes</td><td>signed two-byte integer</td></tr><tr><td>FLOAT</td><td>4 bytes</td><td>single precision floating-point number</td></tr></tbody></table><p>For our next release, our focus on data types will be on complex ones, STRUCT and MAP. So stay tuned for those!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="other-system-functionalities">Other System Functionalities<a href="#other-system-functionalities" class="hash-link" aria-label="Direct link to Other System Functionalities" title="Direct link to Other System Functionalities">‚Äã</a></h2><p><strong>Query timeout</strong>: We will now automatically stop any query that exceeds a specified timeout value (if one exists).
The default query timeout value is set to -1, which signifies that the query timeout feature is initially disabled.
You can activate the query timeout by configuring a positive timeout value through:</p><ul><li><ol><li>C++ API: <code>Connection::setQueryTimeOut(uint64_t timeoutInMS)</code></li></ol></li><li><ol start="2"><li>CLI: <code>:timeout [timeoutValue]</code></li></ol></li></ul><p><strong>Interrupt:</strong> You can also interrupt your queries and can stop your long running queries manually. There
are two ways to do this:</p><ul><li>C++ API: <code>Connection::interrupt()</code>: interrupt all running queries within the current connection.</li><li>CLI: interrupt through <code>CTRL + C</code></li></ul><p>Note: The Interruption and Query Timeout features are not applicable to <code>COPY</code> commands in this release.</p><div class="footnotes"><hr><ol><li id="fn-1-3b764c">Internally, PyG coverts the edge list to CSC format for sampling, which duplicates the graph structures in memory. When you download the graph topology it actually takes about 24GB.<a href="#fnref-1-3b764c" class="footnote-backref">‚Ü©</a></li><li id="fn-2-3b764c">We set <code>num_workers</code> to 16 when running the PyG in-memory setup. Since K√πzu does not currently work with multiple workers in Python, we limit <code>num_workers</code> to 1 when sampling from K√πzu but internally K√πzu scans in parallel with 16 threads.<a href="#fnref-2-3b764c" class="footnote-backref">‚Ü©</a></li></ol></div></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docusaurus/blog/tags/release">release</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docusaurus/blog/kuzu-pyg-remote-backend"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Scaling Pytorch Geometric GNNs With K√πzu</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docusaurus/blog/wcoj"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Why (Graph) DBMSs Need New Join Algorithms: The Story of Worst-case Optimal Join Algorithms</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#k√πzu-as-a-pyg-remote-backend" class="table-of-contents__link toc-highlight">K√πzu as a PyG Remote Backend</a></li><li><a href="#data-ingestion-improvements" class="table-of-contents__link toc-highlight">Data Ingestion Improvements</a></li><li><a href="#query-optimizer-improvements" class="table-of-contents__link toc-highlight">Query Optimizer Improvements</a></li><li><a href="#new-buffer-manager" class="table-of-contents__link toc-highlight">New Buffer Manager</a></li><li><a href="#new-data-types" class="table-of-contents__link toc-highlight">New Data Types</a></li><li><a href="#other-system-functionalities" class="table-of-contents__link toc-highlight">Other System Functionalities</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/kuzudb/shared_invite/zt-1w0thj6s7-0bLaU8Sb~4fDMKJ~oejG_g" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/kuzudb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@KuzuDB" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/410352593" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bilibili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docusaurus/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kuzudb/kuzu" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 K√πzu Team. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus/assets/js/runtime~main.67b2cda9.js"></script>
<script src="/docusaurus/assets/js/main.2d80c558.js"></script>
</body>
</html>